<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"> <link rel="shortcut icon" type="image/png" href="http://127.0.0.1:4000/images/favicon.png" /> <link rel="shortcut icon" href="http://127.0.0.1:4000/images/favicon.ico" /> <link rel="stylesheet" type="text/css" href="http://127.0.0.1:4000/assets/css/main.css"> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="logo.svg"> <meta name="twitter:title" content="Get rid of unused attachments"> <meta name="twitter:description" content="A very annoying thing in WordPress is that you deleting a post doesn’t cascade to the content (attachments) of that post. After a while, you can end up with lots of unused attachments and media files in your library that will only take up hard drive space"> <meta name="twitter:site" content="@username"> <meta name="twitter:creator" content="@username"> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="Get rid of unused attachments"> <meta property="og:description" content="A very annoying thing in WordPress is that you deleting a post doesn’t cascade to the content (attachments) of that post. After a while, you can end up with lots of unused attachments and media files in your library that will only take up hard drive space"> <meta property="og:url" content="http://127.0.0.1:4000/delete-wordpress-attachments/"> <meta property="og:site_name" content="Ahmad Assaf's Blog"> <meta property="og:image" content="http://127.0.0.1:4000/images/logo.svg"> <link rel="canonical" href="http://127.0.0.1:4000/delete-wordpress-attachments/"> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>Get rid of unused attachments &#8211; Ahmad Assaf's Blog</title> <meta name="description" content="A very annoying thing in WordPress is that you deleting a post doesn’t cascade to the content (attachments) of that post. After a while, you can end up with lots of unused attachments and media files in your library that will only take up hard drive space"> <meta name="keywords" content="Wordpress, PHP"> <link type="application/atom+xml" rel="alternate" href="http://127.0.0.1:4000/feed.xml" title="Ahmad Assaf's Blog" /> </head> <body> <div class="fixed-sidebar"></div> <div class="shapes"> </div> <div class="navigation-bar post-navigation "> <div class="header-elements"> </div> <ul class="icon-navigation"> <li class="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></li> <li><i class="fa fa-search" aria-hidden="true"></i></li> </ul> <ul class="categories-list"> <div class="geometry geometry-menu"></div> <li class="current" ><a href="http://127.0.0.1:4000/web-development">web development</a></li> <li ><a href="http://127.0.0.1:4000/Semantic-Web">Semantic Web</a></li> <li ><a href="http://127.0.0.1:4000/projects">projects</a></li> <li ><a href="http://127.0.0.1:4000/Data-Science">Data Science</a></li> <li ><a href="http://127.0.0.1:4000/general">general</a></li> </ul> </div> <div class="content"> <div class="post-header"> <a href="http://127.0.0.1:4000" class="logo"><img src="http://127.0.0.1:4000/images/logo.svg"></a> <div class="post-title-section"> <div class="section-line"><a class="category capitalize" href="http://127.0.0.1:4000/web-development">web development</a><em>/</em></div> <h1 class="section-title">Get rid of unused attachments </h1> <h2 class="section-subtitle">How to Delete WordPress Post Attachments when Deleting the Post ?</h2> <div class="date">July 04 2013</div> <ul class="tags"> <li><a href="http://127.0.0.1:4000/Wordpress">Wordpress</a></li> <li><a href="http://127.0.0.1:4000/PHP">PHP</a></li> </ul> <div class="share-buttons"> <a target="_blank" href="https://twitter.com/intent/tweet?text=http://127.0.0.1:4000/delete-wordpress-attachments/" class="btn btn_twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://127.0.0.1:4000/delete-wordpress-attachments/" class="btn btn_facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a target="_blank" href="https://plus.google.com/share?url=http://127.0.0.1:4000/delete-wordpress-attachments/" class="btn btn_google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a> </div> <div class="section-line reverse"><a href="http://127.0.0.1:4000/blog">Back to posts</a> <em>/</em></div> </div> </div> <div class="blog-post"> <blockquote> <p>A very annoying thing in WordPress is that you deleting a post doesn't cascade to the content (attachments) of that post. After a while, you can end up with lots of unused attachments and media files in your library that will only take up hard drive space</p> </blockquote> <p>A very annoying thing in WordPress is that you deleting a post doesn’t cascade to the content (attachments) of that post. After a while, you can end up with lots of unused attachments and media files in your library that will only take up hard drive space ! The function below will allow deletion of post attachments when the post is deleted.</p> <div class="language-php highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span>
    <span class="k">function</span> <span class="nf">delete_posts_before_delete_post</span><span class="p">(</span><span class="nv">$id</span><span class="p">){</span>
        <span class="nv">$subposts</span> <span class="o">=</span> <span class="nx">get_children</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
            <span class="s1">'post_parent'</span> <span class="o">=&gt;</span> <span class="nv">$id</span><span class="p">,</span>
            <span class="s1">'post_type'</span>   <span class="o">=&gt;</span> <span class="s1">'any'</span><span class="p">,</span>
            <span class="s1">'numberposts'</span> <span class="o">=&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="s1">'post_status'</span> <span class="o">=&gt;</span> <span class="s1">'any'</span>
            <span class="p">));</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$subposts</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$subposts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">){</span>
            <span class="nv">$uploadpath</span> <span class="o">=</span> <span class="nx">wp_upload_dir</span><span class="p">();</span>

            <span class="k">foreach</span><span class="p">(</span><span class="nv">$subposts</span> <span class="k">as</span> <span class="nv">$subpost</span><span class="p">){</span>

                <span class="nv">$_wp_attached_file</span> <span class="o">=</span> <span class="nx">get_post_meta</span><span class="p">(</span><span class="nv">$subpost</span><span class="o">-&gt;</span><span class="na">ID</span><span class="p">,</span> <span class="s1">'_wp_attached_file'</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

                <span class="nv">$original</span> <span class="o">=</span> <span class="nb">basename</span><span class="p">(</span><span class="nv">$_wp_attached_file</span><span class="p">);</span>
                <span class="nv">$pos</span> <span class="o">=</span> <span class="nb">strpos</span><span class="p">(</span><span class="nb">strrev</span><span class="p">(</span><span class="nv">$original</span><span class="p">),</span> <span class="s1">'.'</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$original</span><span class="p">,</span> <span class="s1">'.'</span><span class="p">)</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">){</span>
                    <span class="nv">$ext</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s1">'.'</span><span class="p">,</span> <span class="nb">strrev</span><span class="p">(</span><span class="nv">$original</span><span class="p">));</span>
                    <span class="nv">$ext</span> <span class="o">=</span> <span class="nb">strrev</span><span class="p">(</span><span class="nv">$ext</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nv">$ext</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s1">'-'</span><span class="p">,</span> <span class="nb">strrev</span><span class="p">(</span><span class="nv">$original</span><span class="p">));</span>
                    <span class="nv">$ext</span> <span class="o">=</span> <span class="nb">strrev</span><span class="p">(</span><span class="nv">$ext</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
                <span class="p">}</span>

                <span class="nv">$pattern</span> <span class="o">=</span> <span class="nv">$uploadpath</span><span class="p">[</span><span class="s1">'basedir'</span><span class="p">]</span><span class="o">.</span><span class="s1">'/'</span><span class="o">.</span><span class="nb">dirname</span><span class="p">(</span><span class="nv">$_wp_attached_file</span><span class="p">)</span><span class="o">.</span><span class="s1">'/'</span><span class="o">.</span><span class="nb">basename</span><span class="p">(</span><span class="nv">$original</span><span class="p">,</span> <span class="s1">'.'</span><span class="o">.</span><span class="nv">$ext</span><span class="p">)</span><span class="o">.</span><span class="s1">'-[0-9]*x[0-9]*.'</span><span class="o">.</span><span class="nv">$ext</span><span class="p">;</span>
                <span class="nv">$original</span><span class="o">=</span> <span class="nv">$uploadpath</span><span class="p">[</span><span class="s1">'basedir'</span><span class="p">]</span><span class="o">.</span><span class="s1">'/'</span><span class="o">.</span><span class="nb">dirname</span><span class="p">(</span><span class="nv">$_wp_attached_file</span><span class="p">)</span><span class="o">.</span><span class="s1">'/'</span><span class="o">.</span><span class="nb">basename</span><span class="p">(</span><span class="nv">$original</span><span class="p">,</span> <span class="s1">'.'</span><span class="o">.</span><span class="nv">$ext</span><span class="p">)</span><span class="o">.</span><span class="s1">'.'</span><span class="o">.</span><span class="nv">$ext</span><span class="p">;</span>

                <span class="k">if</span> <span class="p">(</span><span class="nb">getimagesize</span><span class="p">(</span><span class="nv">$original</span><span class="p">)){</span>
                    <span class="nv">$thumbs</span> <span class="o">=</span> <span class="nb">glob</span><span class="p">(</span><span class="nv">$pattern</span><span class="p">);</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$thumbs</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$thumbs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">){</span>
                        <span class="k">foreach</span><span class="p">(</span><span class="nv">$thumbs</span> <span class="k">as</span> <span class="nv">$thumb</span><span class="p">)</span>
                            <span class="nb">unlink</span><span class="p">(</span><span class="nv">$thumb</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>

                <span class="nx">wp_delete_attachment</span><span class="p">(</span> <span class="nv">$subpost</span><span class="o">-&gt;</span><span class="na">ID</span><span class="p">,</span> <span class="kc">true</span> <span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="cp">?&gt;</span>
</code></pre></div> <p>Now, we just need to add some hooks in order to run this function automatically when a delete action is triggered.</p> <div class="language-php highlighter-rouge"><pre class="highlight"><code>### Up-To WordPress 3.1

add_action('delete_post', 'delete_posts_before_delete_post');

### From WordPress 3.2

add_action('before_delete_post', 'delete_posts_before_delete_post');
</code></pre></div> <br> <a target="_blank" href="https://twitter.com/intent/tweet?text=http://127.0.0.1:4000/delete-wordpress-attachments/" class="btn btn_twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://127.0.0.1:4000/delete-wordpress-attachments/" class="btn btn_facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a target="_blank" href="https://plus.google.com/share?url=http://127.0.0.1:4000/delete-wordpress-attachments/" class="btn btn_google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a> </div> <nav class="pagination"> <a href="#" class="pagination_pager disabled">previous</a> <a href="http://127.0.0.1:4000/how-to-get-all-the-tags-for-a-wordpress-category/" class="pagination_pager" title="How to get all the tags for a WordPress Category ? ">next</a> </nav> <script src="http://127.0.0.1:4000/assets/js/build/main.js"></script> <script type="text/javascript"src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> <!-- Asynchronous Google Analytics snippet --> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-11075253-1', 'auto'); ga('require', 'linkid', 'linkid.js'); ga('send', 'pageview'); </script> <div class="overlay"> <ul class="projects-menu"> <li style="background:url(http://taylantatli.me/Halve/images/halve-home-image.png) center center no-repeat;"> <a href="http://taylantatli.me/Halve" class="inactive" target="_blank" rel="nofollow external"> <span> Halve Jekyll Theme <br><em>in progress</em> </span> </a> </li> <li style="background:url(https://cloud.githubusercontent.com/assets/754514/14509720/61c61058-01d6-11e6-93ab-0918515ecd56.png) center center no-repeat;"> <a href="http://taylantatli.me/Moon" target="_blank" rel="nofollow external"> <span> Moon Jekyll Theme </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/Ramme/master/assets/img/screenshot-post.png) center center no-repeat;"> <a href="http://taylantatli.me/Ramme" target="_blank" rel="nofollow external"> <span> Ramme Jekyll Theme </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/Daisy-Pelican-Theme/master/Preview-1.png) center center no-repeat;"> <a href="http://taylantatli.me/Daisy-Pelican-Theme/" target="_blank" rel="nofollow external"> <span> Daisy Pelican Theme </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/Block-Icon-Theme/master/Preview.png) center center no-repeat;"> <a href="https://github.com/TaylanTatli/Block-Icon-Theme" class="inactive" target="_blank" rel="nofollow external"> <span> Block Icon Theme <br><em>in progress</em> </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/StartPage/master/preview.png) center center no-repeat;"> <a href="http://taylantatli.me/StartPage/" class="inactive" target="_blank" rel="nofollow external"> <span> Start Page <br><em>in progress</em> </span> </a> </li> </ul> </div> </div> </body> </html>
