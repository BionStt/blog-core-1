<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"> <link rel="shortcut icon" type="image/png" href="http://127.0.0.1:4000/images/favicon.png" /> <link rel="shortcut icon" href="http://127.0.0.1:4000/images/favicon.ico" /> <link rel="stylesheet" type="text/css" href="http://127.0.0.1:4000/assets/css/main.css"> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="logo.svg"> <meta name="twitter:title" content="Cleaning up Wordpress tags"> <meta name="twitter:description" content="I have decided to write a small PHP script that will scan my WordPress database and posts to determine the unique tags that i should ONLY have"> <meta name="twitter:site" content="@username"> <meta name="twitter:creator" content="@username"> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="Cleaning up Wordpress tags"> <meta property="og:description" content="I have decided to write a small PHP script that will scan my WordPress database and posts to determine the unique tags that i should ONLY have"> <meta property="og:url" content="http://127.0.0.1:4000/cleaning-wordpress-tags-the-right-way/"> <meta property="og:site_name" content="Ahmad Assaf's Blog"> <meta property="og:image" content="http://127.0.0.1:4000/images/logo.svg"> <link rel="canonical" href="http://127.0.0.1:4000/cleaning-wordpress-tags-the-right-way/"> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>Cleaning up Wordpress tags &#8211; Ahmad Assaf's Blog</title> <meta name="description" content="I have decided to write a small PHP script that will scan my WordPress database and posts to determine the unique tags that i should ONLY have"> <meta name="keywords" content="Wordpress, PHP"> <link type="application/atom+xml" rel="alternate" href="http://127.0.0.1:4000/feed.xml" title="Ahmad Assaf's Blog" /> </head> <body> <div class="fixed-sidebar"></div> <div class="shapes"> </div> <div class="navigation-bar post-navigation "> <div class="header-elements"> </div> <ul class="icon-navigation"> <li class="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></li> <li><i class="fa fa-search" aria-hidden="true"></i></li> </ul> <ul class="categories-list"> <div class="geometry geometry-menu"></div> <li class="current" ><a href="http://127.0.0.1:4000/web-development">web development</a></li> <li ><a href="http://127.0.0.1:4000/Semantic-Web">Semantic Web</a></li> <li ><a href="http://127.0.0.1:4000/projects">projects</a></li> <li ><a href="http://127.0.0.1:4000/Data-Science">Data Science</a></li> <li ><a href="http://127.0.0.1:4000/general">general</a></li> </ul> </div> <div class="content"> <div class="post-header"> <a href="http://127.0.0.1:4000" class="logo"><img src="http://127.0.0.1:4000/images/logo.svg"></a> <div class="post-title-section"> <div class="section-line"><a class="category capitalize" href="http://127.0.0.1:4000/web-development">web development</a><em>/</em></div> <h1 class="section-title">Cleaning up Wordpress tags </h1> <h2 class="section-subtitle"></h2> <div class="date">February 18 2014</div> <ul class="tags"> <li><a href="http://127.0.0.1:4000/Wordpress">Wordpress</a></li> <li><a href="http://127.0.0.1:4000/PHP">PHP</a></li> </ul> <div class="share-buttons"> <a target="_blank" href="https://twitter.com/intent/tweet?text=http://127.0.0.1:4000/cleaning-wordpress-tags-the-right-way/" class="btn btn_twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://127.0.0.1:4000/cleaning-wordpress-tags-the-right-way/" class="btn btn_facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a target="_blank" href="https://plus.google.com/share?url=http://127.0.0.1:4000/cleaning-wordpress-tags-the-right-way/" class="btn btn_google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a> </div> <div class="section-line reverse"><a href="http://127.0.0.1:4000/blog">Back to posts</a> <em>/</em></div> </div> </div> <div class="blog-post"> <blockquote> <p>I have decided to write a small PHP script that will scan my WordPress database and posts to determine the unique tags that i should ONLY have</p> </blockquote> <p>During the process of designing my blog (which i considered as a learning playground mostly) i had to import/export the database multiple times, delete and review posts and do lots of changes in my posts. In the end, i have noticed that although i have cleaned my posts, the number of tags is still unrealistic. After some digging, i discovered that at some point, WordPress was not cleaning my tags for unknown reasons to me up to now. I have decided to write a small PHP script that will scan my WordPress database and posts to determine the unique tags that i should ONLY have. The code below will do the following steps:</p> <ul> <li>Retrieve all <strong>published</strong> posts (the status can be changed easily in the passed param array)</li> <li>Get all the tags in WordPress database</li> <li>Get all the tags assigned to these posts</li> <li>Check if there exist any WordPress post with no tags assigned and notify the user</li> <li>Print out the statistics, and delete all the extra tags found (you can enter a prompt here or allow for manual deletion)</li> </ul> <div class="language-php highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="c1">// Include Wordpress main file to be able to access WP functions
</span><span class="k">include</span><span class="p">(</span><span class="s1">'blog/wp-load.php'</span><span class="p">);</span>
<span class="c1">// Define the scope of the search for posts, pages (published, drafts ... )
</span><span class="nv">$args</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span> <span class="s1">'post_type'</span> <span class="o">=&gt;</span> <span class="s1">'post'</span><span class="p">,</span> <span class="s1">'post_status'</span> <span class="o">=&gt;</span> <span class="s1">'publish'</span><span class="p">,</span> <span class="s1">'posts_per_page'</span> <span class="o">=&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<span class="nv">$posts_array</span> <span class="o">=</span> <span class="nx">get_posts</span><span class="p">(</span> <span class="nv">$args</span> <span class="p">);</span>

<span class="k">echo</span> <span class="s2">" We have found "</span><span class="o">.</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$posts_array</span><span class="p">)</span> <span class="o">.</span> <span class="s2">" posts&lt;/br&gt;&lt;/br&gt;"</span><span class="p">;</span>

<span class="c1">// The array that will hold the total tags for all the posts
</span><span class="nv">$tags_array</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>

<span class="c1">// The tags array that is returned by Wordpress that contains extra bad tags
</span><span class="nv">$tags</span> <span class="o">=</span> <span class="nx">get_tags</span><span class="p">();</span>
<span class="c1">// This array will only hold the names of the tags in order to create a diff
</span><span class="nv">$tagsNames</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
<span class="nv">$wordpress_total_tags</span> <span class="o">=</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$tags</span><span class="p">);</span>

<span class="c1">// Start the WP loop in order to check posts
</span><span class="k">foreach</span><span class="p">(</span> <span class="nv">$posts_array</span> <span class="k">as</span> <span class="nv">$post</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">setup_postdata</span><span class="p">(</span><span class="nv">$post</span><span class="p">);</span>
    <span class="nb">ob_start</span><span class="p">();</span><span class="nb">ob_end_clean</span><span class="p">();</span>

    <span class="nv">$post_tags</span> <span class="o">=</span> <span class="nx">get_the_tags</span><span class="p">();</span> <span class="c1">//get the post tags
</span>    <span class="c1">// Check if the post contain any tags, if not we will notify the user with the post's name and link
</span>    <span class="k">if</span> <span class="p">(</span><span class="nv">$post_tags</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">foreach</span><span class="p">(</span><span class="nv">$post_tags</span> <span class="k">as</span> <span class="nv">$tag</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$tags_array</span><span class="p">[]</span> <span class="o">=</span>  <span class="nv">$tag</span><span class="o">-&gt;</span><span class="na">term_id</span> <span class="p">;</span> <span class="c1">//get the tag name. This can be changed to term_id or whatever you want
</span>        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">echo</span> <span class="s2">"We have found no Tags in post: "</span> <span class="o">.</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">ID</span> <span class="o">.</span> <span class="s2">" name: "</span><span class="o">.</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">post_name</span> <span class="o">.</span><span class="s2">" &lt;a href='http://ahmadassaf.com/blog/wp-admin/post.php?post="</span> <span class="o">.</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">ID</span><span class="o">.</span><span class="s2">"&amp;action=edit'&gt;Link&lt;/a&gt;&lt;/br&gt;&lt;/br&gt;"</span><span class="p">;</span>

<span class="p">}</span>

<span class="nv">$total_posts_tags</span>   <span class="o">=</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$tags_array</span><span class="p">);</span> <span class="c1">//total number of tags in all posts
</span><span class="nv">$unique_tags_array</span>  <span class="o">=</span> <span class="nb">array_unique</span><span class="p">(</span><span class="nv">$tags_array</span><span class="p">);</span> <span class="c1">//unique tags only from the posts
</span><span class="nv">$actual_unique_tags</span> <span class="o">=</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$unique_tags_array</span><span class="p">);</span> <span class="c1">//the number of unique tags found
</span>
<span class="k">echo</span> <span class="s2">"Total of: "</span> <span class="o">.</span> <span class="nv">$wordpress_total_tags</span> <span class="o">.</span> <span class="s2">" Tags in Wordpress Posts&lt;/br&gt;"</span><span class="p">;</span>
<span class="k">echo</span> <span class="s2">"Total of: "</span> <span class="o">.</span> <span class="nv">$total_posts_tags</span> <span class="o">.</span> <span class="s2">" REAL Tags in Wordpress Posts&lt;/br&gt;"</span><span class="p">;</span>
<span class="k">echo</span> <span class="s2">"Total of: "</span> <span class="o">.</span> <span class="nv">$actual_unique_tags</span> <span class="o">.</span> <span class="s2">" REAL &amp; UNIQUE Tags in Wordpress Posts&lt;/br&gt;&lt;/br&gt;"</span><span class="p">;</span>
<span class="k">echo</span> <span class="s2">"There are: "</span> <span class="o">.</span> <span class="p">(</span><span class="nv">$wordpress_total_tags</span> <span class="o">-</span> <span class="nv">$actual_unique_tags</span><span class="p">)</span> <span class="o">.</span> <span class="s2">" Extra Tags Found&lt;/br&gt;"</span><span class="p">;</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$tags</span> <span class="k">as</span> <span class="nv">$tag</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$tagsNames</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$tag</span><span class="o">-&gt;</span><span class="na">term_id</span> <span class="p">;</span>
<span class="p">}</span>

<span class="nv">$extra_tags</span> <span class="o">=</span>  <span class="nb">array_diff</span><span class="p">(</span><span class="nv">$tagsNames</span><span class="p">,</span> <span class="nv">$unique_tags_array</span><span class="p">);</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$extra_tags</span> <span class="k">as</span> <span class="nv">$term_id</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">wp_delete_term</span><span class="p">(</span> <span class="nv">$term_id</span><span class="p">,</span> <span class="s1">'post_tag'</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">?&gt;</span>
</code></pre></div> <p>The end result will look like this:</p> <div class="language-bash highlighter-rouge"><pre class="highlight"><code>We have found 285 posts

We have found no Tags <span class="k">in </span>post: 60231 name: modern-powerful-php-debugging-helper-kint Link

Total of: 1009 Tags <span class="k">in </span>Wordpress Posts
Total of: 1686 REAL Tags <span class="k">in </span>Wordpress Posts
Total of: 788 REAL &amp; UNIQUE Tags <span class="k">in </span>Wordpress Posts

There are: 221 Extra Tags Found
Array <span class="o">(</span> <span class="o">[</span>1] <span class="o">=</span>&gt; .htaccess <span class="o">[</span>3] <span class="o">=</span>&gt; 960 Grid System <span class="o">[</span>9] <span class="o">=</span>&gt; Add-ons <span class="o">[</span>11] <span class="o">=</span>&gt; Adipoli <span class="o">[</span>12] <span class="o">=</span>&gt; Adobe Creative Suite <span class="o">[</span>13] ........

Running the code again will output

We have found 285 posts

We have found no Tags <span class="k">in </span>post: 60231 name: modern-powerful-php-debugging-helper-kint Link

Total of: 788 Tags <span class="k">in </span>Wordpress Posts
Total of: 1686 REAL Tags <span class="k">in </span>Wordpress Posts
Total of: 788 REAL &amp; UNIQUE Tags <span class="k">in </span>Wordpress Posts

There are: 0 Extra Tags Found
</code></pre></div> <p>I hope you found this post useful, and please don’t hesitate to write a comment if you have any question.</p> <br> <a target="_blank" href="https://twitter.com/intent/tweet?text=http://127.0.0.1:4000/cleaning-wordpress-tags-the-right-way/" class="btn btn_twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://127.0.0.1:4000/cleaning-wordpress-tags-the-right-way/" class="btn btn_facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a target="_blank" href="https://plus.google.com/share?url=http://127.0.0.1:4000/cleaning-wordpress-tags-the-right-way/" class="btn btn_google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a> </div> <nav class="pagination"> <a href="http://127.0.0.1:4000/introduction-to-semantic-web/" class="pagination_pager" title="Introduction to Semantic Web ">previous</a> <a href="http://127.0.0.1:4000/everything-you-need-to-know-about-rdf/" class="pagination_pager" title="Everything you need to know about RDF ">next</a> </nav> <script src="http://127.0.0.1:4000/assets/js/build/main.js"></script> <script type="text/javascript"src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> <!-- Asynchronous Google Analytics snippet --> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-11075253-1', 'auto'); ga('require', 'linkid', 'linkid.js'); ga('send', 'pageview'); </script> <div class="overlay"> <ul class="projects-menu"> <li style="background:url(http://taylantatli.me/Halve/images/halve-home-image.png) center center no-repeat;"> <a href="http://taylantatli.me/Halve" class="inactive" target="_blank" rel="nofollow external"> <span> Halve Jekyll Theme <br><em>in progress</em> </span> </a> </li> <li style="background:url(https://cloud.githubusercontent.com/assets/754514/14509720/61c61058-01d6-11e6-93ab-0918515ecd56.png) center center no-repeat;"> <a href="http://taylantatli.me/Moon" target="_blank" rel="nofollow external"> <span> Moon Jekyll Theme </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/Ramme/master/assets/img/screenshot-post.png) center center no-repeat;"> <a href="http://taylantatli.me/Ramme" target="_blank" rel="nofollow external"> <span> Ramme Jekyll Theme </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/Daisy-Pelican-Theme/master/Preview-1.png) center center no-repeat;"> <a href="http://taylantatli.me/Daisy-Pelican-Theme/" target="_blank" rel="nofollow external"> <span> Daisy Pelican Theme </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/Block-Icon-Theme/master/Preview.png) center center no-repeat;"> <a href="https://github.com/TaylanTatli/Block-Icon-Theme" class="inactive" target="_blank" rel="nofollow external"> <span> Block Icon Theme <br><em>in progress</em> </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/StartPage/master/preview.png) center center no-repeat;"> <a href="http://taylantatli.me/StartPage/" class="inactive" target="_blank" rel="nofollow external"> <span> Start Page <br><em>in progress</em> </span> </a> </li> </ul> </div> </div> </body> </html>
