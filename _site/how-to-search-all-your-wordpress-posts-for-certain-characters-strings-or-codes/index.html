<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"> <link rel="shortcut icon" type="image/png" href="http://127.0.0.1:4000/images/favicon.png" /> <link rel="shortcut icon" href="http://127.0.0.1:4000/images/favicon.ico" /> <link rel="stylesheet" type="text/css" href="http://127.0.0.1:4000/assets/css/main.css"> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="logo.svg"> <meta name="twitter:title" content="Search Wordpress Posts"> <meta name="twitter:description" content="During my many trials to start a useful blog, i have tried a handful of plugins and extensions that do all sort of stuff. However, after a while, especially when i became more and more familiar with PHP and WordPress, i decided to dump lots of these plugins and go with self developed tailored functions"> <meta name="twitter:site" content="@username"> <meta name="twitter:creator" content="@username"> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="Search Wordpress Posts"> <meta property="og:description" content="During my many trials to start a useful blog, i have tried a handful of plugins and extensions that do all sort of stuff. However, after a while, especially when i became more and more familiar with PHP and WordPress, i decided to dump lots of these plugins and go with self developed tailored functions"> <meta property="og:url" content="http://127.0.0.1:4000/how-to-search-all-your-wordpress-posts-for-certain-characters-strings-or-codes/"> <meta property="og:site_name" content="Ahmad Assaf's Blog"> <meta property="og:image" content="http://127.0.0.1:4000/images/logo.svg"> <link rel="canonical" href="http://127.0.0.1:4000/how-to-search-all-your-wordpress-posts-for-certain-characters-strings-or-codes/"> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>Search Wordpress Posts &#8211; Ahmad Assaf's Blog</title> <meta name="description" content="During my many trials to start a useful blog, i have tried a handful of plugins and extensions that do all sort of stuff. However, after a while, especially when i became more and more familiar with PHP and WordPress, i decided to dump lots of these plugins and go with self developed tailored functions"> <meta name="keywords" content="Wordpress, PHP"> <link type="application/atom+xml" rel="alternate" href="http://127.0.0.1:4000/feed.xml" title="Ahmad Assaf's Blog" /> </head> <body> <div class="fixed-sidebar"></div> <div class="shapes"> </div> <div class="navigation-bar post-navigation "> <div class="header-elements"> </div> <ul class="icon-navigation"> <li class="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></li> <li><i class="fa fa-search" aria-hidden="true"></i></li> </ul> <ul class="categories-list"> <div class="geometry geometry-menu"></div> <li class="current" ><a href="http://127.0.0.1:4000/web-development">web development</a></li> <li ><a href="http://127.0.0.1:4000/Semantic-Web">Semantic Web</a></li> <li ><a href="http://127.0.0.1:4000/projects">projects</a></li> <li ><a href="http://127.0.0.1:4000/Data-Science">Data Science</a></li> <li ><a href="http://127.0.0.1:4000/general">general</a></li> </ul> </div> <div class="content"> <div class="post-header"> <a href="http://127.0.0.1:4000" class="logo"><img src="http://127.0.0.1:4000/images/logo.svg"></a> <div class="post-title-section"> <div class="section-line"><a class="category capitalize" href="http://127.0.0.1:4000/web-development">web development</a><em>/</em></div> <h1 class="section-title">Search Wordpress Posts </h1> <h2 class="section-subtitle">search all your WordPress posts for certain characters, Strings or Codes ?</h2> <div class="date">October 22 2013</div> <ul class="tags"> <li><a href="http://127.0.0.1:4000/Wordpress">Wordpress</a></li> <li><a href="http://127.0.0.1:4000/PHP">PHP</a></li> </ul> <div class="share-buttons"> <a target="_blank" href="https://twitter.com/intent/tweet?text=http://127.0.0.1:4000/how-to-search-all-your-wordpress-posts-for-certain-characters-strings-or-codes/" class="btn btn_twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://127.0.0.1:4000/how-to-search-all-your-wordpress-posts-for-certain-characters-strings-or-codes/" class="btn btn_facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a target="_blank" href="https://plus.google.com/share?url=http://127.0.0.1:4000/how-to-search-all-your-wordpress-posts-for-certain-characters-strings-or-codes/" class="btn btn_google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a> </div> <div class="section-line reverse"><a href="http://127.0.0.1:4000/blog">Back to posts</a> <em>/</em></div> </div> </div> <div class="blog-post"> <blockquote> <p>During my many trials to start a useful blog, i have tried a handful of plugins and extensions that do all sort of stuff. However, after a while, especially when i became more and more familiar with PHP and WordPress, i decided to dump lots of these plugins and go with self developed tailored functions</p> </blockquote> <p>During my many trials to start a useful blog, i have tried a handful of plugins and extensions that do all sort of stuff. However, after a while, especially when i became more and more familiar with PHP and WordPress, i decided to dump lots of these plugins and go with self developed tailored functions. Unfortunately, uninstalling these plugins did not solve all my problems. Some of them did actually insert some special markup to my posts ( mostly logos and links, for example the <a href="http://wordpress.org/plugins/zemanta/">Zemanta Plugin</a> ). I decided that i had to clean up my posts from such ‘malicious’ markup. So i had to first of all to find the infected posts. To do so, i did write a small snippet that will run and search for several posts that contain specific strings, or characters or codes. I did run this code in a separate PHP file in the root of my domain. <a href="http://wordpress.stackexchange.com/questions/47049/what-is-the-correct-way-to-use-wordpress-functions-outside-wordpress-files">You need to provide access to your WordPress installation though</a>. In the first step, we first need to fetch all the posts that wee need to inspect. In my snippet i specified that i need to search for <strong>posts</strong> that have been <strong>published</strong>. You can change these parameters to include drafts, pending posts, pages and so on.</p> <div class="language-php highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span>
    <span class="nv">$args</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span> <span class="s1">'post_type'</span> <span class="o">=&gt;</span> <span class="s1">'post'</span><span class="p">,</span> <span class="s1">'post_status'</span> <span class="o">=&gt;</span> <span class="s1">'publish'</span><span class="p">,</span> <span class="s1">'posts_per_page'</span> <span class="o">=&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="nv">$posts_array</span> <span class="o">=</span> <span class="nx">get_posts</span><span class="p">(</span> <span class="nv">$args</span> <span class="p">);</span>
    <span class="k">echo</span> <span class="s2">" We have found "</span><span class="o">.</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$posts_array</span><span class="p">)</span> <span class="o">.</span> <span class="s2">" posts&lt;/br&gt;"</span><span class="p">;</span>
<span class="cp">?&gt;</span>
</code></pre></div> <p>Now, we need to loop through all the posts and start searching</p> <div class="language-php highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="k">foreach</span><span class="p">(</span> <span class="nv">$posts_array</span> <span class="k">as</span> <span class="nv">$post</span> <span class="p">)</span> <span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="nx">setup_postdata</span><span class="p">(</span><span class="nv">$post</span><span class="p">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="nb">ob_start</span><span class="p">();</span><span class="nb">ob_end_clean</span><span class="p">();</span>
<span class="err"> </span> <span class="err"> </span> <span class="nv">$output</span> <span class="o">=</span> <span class="nb">strstr</span><span class="p">(</span><span class="nv">$post</span><span class="o">-&gt;</span><span class="na">post_content</span><span class="p">,</span> <span class="s1">'zemanta-pixie'</span><span class="p">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="nv">$post_categories</span> <span class="o">=</span> <span class="nx">wp_get_post_categories</span><span class="p">(</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">ID</span> <span class="p">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="nv">$output</span> <span class="o">=</span> <span class="err"> </span><span class="nx">in_category</span><span class="p">(</span> <span class="s1">'miscellaneous'</span> <span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$post_categories</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="k">if</span> <span class="p">(</span><span class="nv">$output</span><span class="p">)</span> <span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">echo</span> <span class="s2">"We have found code in post: "</span> <span class="o">.</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">ID</span> <span class="o">.</span> <span class="s2">" name: "</span><span class="o">.</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span><span class="nv">$post</span><span class="o">-&gt;</span><span class="na">post_name</span> <span class="o">.</span><span class="s2">" &lt;a href=YOUR-WORDPRESS-ADDRESS/wp-admin/post.php?post="</span> <span class="o">.</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span><span class="nv">$post</span><span class="o">-&gt;</span><span class="na">ID</span><span class="o">.</span><span class="s2">"&amp;action=edit'&gt;Link&lt;/a&gt;&lt;/br&gt;"</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span>

The search part happens in the string matching, you can change the string to whatever you want to look for:

```php
<span class="cp">&lt;?php</span>
    <span class="nv">$output</span> <span class="o">=</span> <span class="nb">strstr</span><span class="p">(</span><span class="nv">$post</span><span class="o">-&gt;</span><span class="na">post_content</span><span class="p">,</span> <span class="s1">'zemanta-pixie'</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre></div> <p>You can perform a set of secondary sanity checks if you wish, i have included some just in case. For example, i am checking if the post found is not a specific category “miscellaneous” and that that the post belongs to only ONE category.</p> <div class="language-php highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span>
    <span class="nv">$post_categories</span> <span class="o">=</span> <span class="nx">wp_get_post_categories</span><span class="p">(</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">ID</span> <span class="p">);</span>
    <span class="nv">$output</span> <span class="o">=</span> <span class="err"> </span><span class="nx">in_category</span><span class="p">(</span> <span class="s1">'miscellaneous'</span> <span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$post_categories</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">;</span>
<span class="cp">?&gt;</span>
</code></pre></div> <p>Finally, when we output the link you have to fill in the corresponding WordPress Installation URL so that you will be able to directly edit the post.</p> <div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">YOUR-WORDPRESS-ADDRESS/wp-admin/post.php?post="</span> <span class="err">. $</span><span class="na">post-</span><span class="nt">&gt;</span>ID."<span class="err">&amp;</span>action=edit'&gt;Link<span class="nt">&lt;/a&gt;</span>
</code></pre></div> <p>Now, if you are searching for specific HTML tags in your post then you only need to change the search line to become:</p> <div class="language-php highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="nv">$output</span> <span class="o">=</span> <span class="nb">preg_match_all</span><span class="p">(</span><span class="s1">'/&lt;blockquote.*&gt;/'</span><span class="p">,</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">post_content</span><span class="p">,</span> <span class="nv">$matches</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre></div> <p>where we look for the existence of <code class="highlighter-rouge">blockquote</code> tags.</p> <h2 id="the-code">The code</h2> <div class="language-php highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span>
    <span class="c1">// Include Wordpress main file to be able to access WP functions
</span>    <span class="k">include</span><span class="p">(</span><span class="s1">'blog/wp-load.php'</span><span class="p">);</span>
    <span class="c1">// Define the scope of the search for posts, pages (published, drafts ... )
</span>    <span class="nv">$args</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span> <span class="s1">'post_type'</span> <span class="o">=&gt;</span> <span class="s1">'post'</span><span class="p">,</span> <span class="s1">'post_status'</span> <span class="o">=&gt;</span> <span class="s1">'publish'</span><span class="p">,</span> <span class="s1">'posts_per_page'</span> <span class="o">=&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="nv">$posts_array</span> <span class="o">=</span> <span class="nx">get_posts</span><span class="p">(</span> <span class="nv">$args</span> <span class="p">);</span>

    <span class="k">echo</span> <span class="s2">" We have found "</span><span class="o">.</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$posts_array</span><span class="p">)</span> <span class="o">.</span> <span class="s2">" posts"</span><span class="p">;</span><span class="c1">// Simple counter to check the number of "infected" posts
</span>    <span class="nv">$count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="c1">// Start the WP loop in order to check posts
</span>    <span class="k">foreach</span><span class="p">(</span> <span class="nv">$posts_array</span> <span class="k">as</span> <span class="nv">$post</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">setup_postdata</span><span class="p">(</span><span class="nv">$post</span><span class="p">);</span>
        <span class="nb">ob_start</span><span class="p">();</span><span class="nb">ob_end_clean</span><span class="p">();</span>

        <span class="c1">// Here we define the search parameters .. you can specify HTML tags here
</span>        <span class="nv">$output</span> <span class="o">=</span> <span class="nb">preg_match_all</span><span class="p">(</span><span class="s1">'/&lt;blockquote.*&gt;/'</span><span class="p">,</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">post_content</span><span class="p">,</span> <span class="nv">$matches</span><span class="p">);</span>
        <span class="c1">// You can specify a set of characters or Strings here
</span>        <span class="nv">$output</span> <span class="o">=</span> <span class="nb">strstr</span><span class="p">(</span><span class="nv">$post</span><span class="o">-&gt;</span><span class="na">post_content</span><span class="p">,</span> <span class="s1">'zemanta-pixie'</span><span class="p">);</span>

        <span class="nv">$post_categories</span> <span class="o">=</span> <span class="nx">wp_get_post_categories</span><span class="p">(</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">ID</span> <span class="p">);</span>

        <span class="c1">// Another type of filtering .. checking post categories and number of posts
</span>        <span class="nv">$output</span> <span class="o">=</span>  <span class="nx">in_category</span><span class="p">(</span> <span class="s1">'miscellaneous'</span> <span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$post_categories</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$output</span><span class="p">)</span> <span class="p">{</span>
            <span class="nb">print_r</span><span class="p">(</span><span class="nv">$matches</span><span class="p">);</span>
            <span class="k">echo</span> <span class="s2">"We have found code in post: "</span> <span class="o">.</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">ID</span> <span class="o">.</span> <span class="s2">" name: "</span><span class="o">.</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">post_name</span> <span class="o">.</span><span class="s2">" &lt;a href='http://ahmadassaf.com/blog/wp-admin/post.php?post="</span> <span class="o">.</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">ID</span><span class="o">.</span><span class="s2">"&amp;action=edit'&gt;Link&lt;/a&gt;&lt;/br&gt;"</span><span class="p">;</span>
            <span class="nv">$count</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">echo</span> <span class="s2">"Total of: "</span> <span class="o">.</span> <span class="nv">$count</span> <span class="o">.</span> <span class="s2">"&lt;/br&gt;"</span><span class="p">;</span>
<span class="cp">?&gt;</span>
</code></pre></div> <br> <a target="_blank" href="https://twitter.com/intent/tweet?text=http://127.0.0.1:4000/how-to-search-all-your-wordpress-posts-for-certain-characters-strings-or-codes/" class="btn btn_twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://127.0.0.1:4000/how-to-search-all-your-wordpress-posts-for-certain-characters-strings-or-codes/" class="btn btn_facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a target="_blank" href="https://plus.google.com/share?url=http://127.0.0.1:4000/how-to-search-all-your-wordpress-posts-for-certain-characters-strings-or-codes/" class="btn btn_google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a> </div> <nav class="pagination"> <a href="http://127.0.0.1:4000/how-to-get-all-the-tags-for-a-wordpress-category/" class="pagination_pager" title="How to get all the tags for a WordPress Category ? ">previous</a> <a href="http://127.0.0.1:4000/how-to-extract-a-post-first-image,-add-it-to-the-media-library-and-assign-it-as-a-post-thumbnail-in-wordpress/" class="pagination_pager" title="Automatic Wordpress Thumbnails ">next</a> </nav> <script src="http://127.0.0.1:4000/assets/js/build/main.js"></script> <script type="text/javascript"src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> <!-- Asynchronous Google Analytics snippet --> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-11075253-1', 'auto'); ga('require', 'linkid', 'linkid.js'); ga('send', 'pageview'); </script> <div class="overlay"> <ul class="projects-menu"> <li style="background:url(http://taylantatli.me/Halve/images/halve-home-image.png) center center no-repeat;"> <a href="http://taylantatli.me/Halve" class="inactive" target="_blank" rel="nofollow external"> <span> Halve Jekyll Theme <br><em>in progress</em> </span> </a> </li> <li style="background:url(https://cloud.githubusercontent.com/assets/754514/14509720/61c61058-01d6-11e6-93ab-0918515ecd56.png) center center no-repeat;"> <a href="http://taylantatli.me/Moon" target="_blank" rel="nofollow external"> <span> Moon Jekyll Theme </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/Ramme/master/assets/img/screenshot-post.png) center center no-repeat;"> <a href="http://taylantatli.me/Ramme" target="_blank" rel="nofollow external"> <span> Ramme Jekyll Theme </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/Daisy-Pelican-Theme/master/Preview-1.png) center center no-repeat;"> <a href="http://taylantatli.me/Daisy-Pelican-Theme/" target="_blank" rel="nofollow external"> <span> Daisy Pelican Theme </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/Block-Icon-Theme/master/Preview.png) center center no-repeat;"> <a href="https://github.com/TaylanTatli/Block-Icon-Theme" class="inactive" target="_blank" rel="nofollow external"> <span> Block Icon Theme <br><em>in progress</em> </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/StartPage/master/preview.png) center center no-repeat;"> <a href="http://taylantatli.me/StartPage/" class="inactive" target="_blank" rel="nofollow external"> <span> Start Page <br><em>in progress</em> </span> </a> </li> </ul> </div> </div> </body> </html>
